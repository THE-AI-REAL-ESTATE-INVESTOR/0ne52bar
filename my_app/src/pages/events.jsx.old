// This file has been replaced by the App Router version at src/app/events/page.tsx
// Keeping it for reference but renamed to .old to avoid conflicts

'use client';

import React, { useState, useEffect } from 'react';
import Head from 'next/head';
import { EventsList } from '../components/EventsList';

// For development mode, use mock data
import mockEvents from '../data/mock-events.json';

export default function EventsPage() {
  const [events, setEvents] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [useRealData, setUseRealData] = useState(false);

  useEffect(() => {
    async function fetchEvents() {
      setLoading(true);
      
      try {
        if (useRealData) {
          // In production, we'd make a real API call
          // This is placeholder for when you have proper permissions
          const response = await fetch('/api/facebook-events');
          const data = await response.json();
          
          if (data.error) {
            throw new Error(data.error.message || 'Failed to fetch events');
          }
          
          setEvents(data);
        } else {
          // In development, use mock data
          setEvents(mockEvents);
        }
        
        setError(null);
      } catch (err) {
        console.error('Error fetching events:', err);
        setError(err.message);
        // Fallback to mock data on error
        setEvents(mockEvents);
      } finally {
        setLoading(false);
      }
    }
    
    fetchEvents();
  }, [useRealData]);

  return (
    <>
      <Head>
        <title>ONE-52 BAR & GRILL | Events</title>
        <meta name="description" content="Upcoming events at ONE-52 BAR & GRILL" />
      </Head>
      
      <main className="min-h-screen bg-gray-50">
        {/* Page Header */}
        <div className="bg-blue-800 text-white py-12">
          <div className="container mx-auto px-4">
            <h1 className="text-4xl font-bold mb-2">Upcoming Events</h1>
            <p className="text-xl text-blue-100">Join us for amazing events at ONE-52 BAR & GRILL</p>
          </div>
        </div>
        
        {/* Toggle to simulate switching between mock/real data */}
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-end mb-4">
            <label className="flex items-center cursor-pointer">
              <span className="mr-2 text-sm text-gray-600">
                {useRealData ? 'Using API data' : 'Using development data'}
              </span>
              <div className="relative">
                <input 
                  type="checkbox" 
                  className="sr-only" 
                  checked={useRealData}
                  onChange={() => setUseRealData(!useRealData)}
                />
                <div className={`block w-14 h-8 rounded-full ${useRealData ? 'bg-blue-600' : 'bg-gray-400'}`}></div>
                <div className={`absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform ${useRealData ? 'transform translate-x-6' : ''}`}></div>
              </div>
            </label>
          </div>
        </div>
        
        {/* Loading State */}
        {loading && (
          <div className="container mx-auto px-4 py-8 text-center">
            <div className="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-600"></div>
            <p className="mt-2">Loading events...</p>
          </div>
        )}
        
        {/* Error State */}
        {error && (
          <div className="container mx-auto px-4 py-4">
            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6">
              <strong className="font-bold">Error:</strong>
              <span className="block sm:inline"> {error}</span>
              <p className="mt-2 text-sm">Showing mock data instead.</p>
            </div>
          </div>
        )}
        
        {/* Events List */}
        {!loading && events.length > 0 && (
          <EventsList events={events} />
        )}
        
        {/* No Events */}
        {!loading && events.length === 0 && (
          <div className="container mx-auto px-4 py-16 text-center">
            <h2 className="text-2xl font-semibold text-gray-700 mb-4">No events found</h2>
            <p className="text-gray-500">Check back soon for upcoming events!</p>
          </div>
        )}
        
        {/* Development Notice */}
        {!useRealData && (
          <div className="container mx-auto px-4 py-8">
            <div className="bg-amber-100 border border-amber-300 rounded-lg p-4">
              <h3 className="font-semibold text-amber-800">Development Mode</h3>
              <p className="text-amber-700">
                Currently displaying mock event data. In production, this page would fetch real event data from the Facebook API.
              </p>
              <p className="text-amber-700 mt-2">
                To use real Facebook data, you'll need to complete the Facebook App Review process and request the <code className="bg-amber-200 px-1 rounded">pages_read_engagement</code> permission.
              </p>
            </div>
          </div>
        )}
      </main>
    </>
  );
} 